{{ 'rish-custom.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign bg_color = section.settings.bg_color
  assign bg_image = section.settings.bg_image
  assign heading_color = section.settings.heading_color
  assign card_bg_color = section.settings.card_bg_color
  assign text_color = section.settings.text_color
  assign selected_blog = blogs[section.settings.blog]
-%}

<div class="rishu-blog-section" 
     style="{% if bg_color != blank %}background-color: {{ bg_color }};{% endif %}{% if bg_image != blank %}background-image: url('{{ bg_image | image_url: width: 2000 }}');{% endif %}">
  
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <div class="rishu-section-header">
        <h2 class="rishu-section-heading" style="color: {{ heading_color | default: '#000' }};">{{ section.settings.heading }}</h2>
        {%- if section.settings.view_all_link != blank -%}
          <a href="{{ section.settings.view_all_link }}" class="rishu-view-all" style="color: {{ heading_color }};">
            View All <span class="arrow">â†’</span>
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="rishu-blog-wrapper">
   
      
      <div class="rishu-blog-slider" id="rishu-blog-slider-{{ section.id }}">
        {%- if selected_blog != blank and selected_blog.articles_count > 0 -%}
          {%- for article in selected_blog.articles limit: section.settings.post_limit -%}
            <div class="rishu-blog-card" style="background-color: {{ card_bg_color }};">
              <a href="{{ article.url }}" class="rishu-blog-card-link">
                <div class="rishu-blog-image-wrapper">
                  {%- if article.image != blank -%}
                    {{ article.image | image_url: width: 600 | image_tag: 
                      class: 'rishu-blog-img', 
                      loading: 'lazy',
                      alt: article.title
                    }}
                  {%- else -%}
                    {{ 'image' | placeholder_svg_tag: 'rishu-blog-placeholder' }}
                  {%- endif -%}
                  <div class="rishu-blog-date">
                    <span class="day">{{ article.published_at | date: "%d" }}</span>
                    <span class="month">{{ article.published_at | date: "%b" }}</span>
                  </div>
                </div>
                
                <div class="rishu-blog-content">
                  <h3 class="rishu-blog-title" style="color: {{ text_color }};">
                    {{ article.title | truncate: 60 }}
                  </h3>
                  <div class="rishu-blog-excerpt" style="color: {{ text_color | color_modify: 'alpha', 0.8 }};">
                    {%- if article.excerpt.size > 0 -%}
                      {{ article.excerpt | strip_html | truncate: 100 }}
                    {%- else -%}
                      {{ article.content | strip_html | truncate: 100 }}
                    {%- endif -%}
                  </div>
                  <span class="rishu-read-more" style="color: {{ text_color }};">Read Article</span>
                </div>
              </a>
            </div>
          {%- endfor -%}
        {%- else -%}
          {%- comment -%} Onboarding State {%- endcomment -%}
          {%- for i in (1..4) -%}
            <div class="rishu-blog-card" style="background-color: {{ card_bg_color }};">
              <div class="rishu-blog-image-wrapper">
                {{ 'image' | placeholder_svg_tag: 'rishu-blog-placeholder' }}
              </div>
              <div class="rishu-blog-content">
                <h3 class="rishu-blog-title" style="color: {{ text_color }};">Example Blog Post {{ i }}</h3>
                <p class="rishu-blog-excerpt" style="color: {{ text_color | color_modify: 'alpha', 0.8 }};">
                  This is an example excerpt for the blog post to demonstrate the layout.
                </p>
                <span class="rishu-read-more" style="color: {{ text_color }};">Read Article</span>
              </div>
            </div>
          {%- endfor -%}
        {%- endif -%}
      </div>

   
    </div>
  </div>
</div>

<script>
  function scrollRishuBlogSlider(direction) {
    const slider = document.querySelector('.rishu-blog-slider');
    if(slider) {
      const cardWidth = slider.querySelector('.rishu-blog-card')?.offsetWidth || 300;
      const gap = 32; // match css gap
      const scrollAmount = (cardWidth + gap) * direction;
      slider.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    }
  }
</script>

{% schema %}
{
  "name": "Rishu Blog Slider",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Latest from the Blog"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View All Link"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "range",
      "id": "post_limit",
      "min": 3,
      "max": 12,
      "step": 1,
      "label": "Number of posts",
      "default": 6
    },
    {
       "type": "header",
       "content": "Appearance"
    },
    {
       "type": "color",
       "id": "bg_color",
       "label": "Section Background Color",
       "default": "#f4f4f4"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Section Background Image"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    }
  ],
  "presets": [
    {
      "name": "Rishu Blog Slider",
      "category": "Rishu"
    }
  ]
}
{% endschema %}
