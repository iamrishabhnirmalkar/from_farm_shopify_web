{{ 'rish-custom.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign bg_color = section.settings.bg_color
  assign bg_image = section.settings.bg_image
  assign heading_color = section.settings.heading_color
  assign text_color = section.settings.text_color
-%}

<div class="rishu-best-seller-section" 
     style="{% if bg_color != blank %}background-color: {{ bg_color }};{% endif %}{% if bg_image != blank %}background-image: url('{{ bg_image | image_url: width: 2000 }}');{% endif %}">
  
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <h2 class="rishu-section-heading" style="color: {{ heading_color | default: '#000' }};">{{ section.settings.heading }}</h2>
    {%- endif -%}

    <div class="rishu-best-seller-slider">
      {%- comment -%} 1. Manual Blocks Priority {%- endcomment -%}
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {%- assign product = all_products[block.settings.product] -%}
          {%- if product != blank -%}
             <div class="rishu-product-card">
               <div class="rishu-card-image-wrapper">
                 <a href="{{ product.url }}" class="rishu-card-link">
                   {{ product.featured_image | image_url: width: 600 | image_tag: class: 'rishu-card-img', loading: 'lazy' }}
                 </a>
                 
                 {%- comment -%} Badges Container (Top Left) {%- endcomment -%}
                 <div class="rishu-card-badges">
                   {%- if product.compare_at_price > product.price -%}
                     {%- assign discount = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
                     <span class="rishu-badge discount-badge">-{{ discount }}%</span>
                   {%- endif -%}
                   
                   {%- if product.tags.size > 0 -%}
                      <span class="rishu-badge tag-badge">{{ product.tags.first }}</span>
                   {%- endif -%}
                 </div>
               </div>

               <div class="rishu-card-info">
                 <h3 class="rishu-card-title"><a href="{{ product.url }}">{{ product.title | truncate: 50 }}</a></h3>
                 <div class="rishu-card-price">
                   {%- if product.compare_at_price > product.price -%}
                     <span class="price-sale">{{ product.price | money }}</span>
                     <span class="price-compare">{{ product.compare_at_price | money }}</span>
                   {%- else -%}
                     <span class="price-regular">{{ product.price | money }}</span>
                   {%- endif -%}
                 </div>
                 
                 <form method="post" action="/cart/add" class="rishu-quick-add-form">
                   <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                   <button type="submit" class="rishu-btn-add">Add to Cart</button>
                 </form>
               </div>
             </div>
          {%- endif -%}
        {%- endfor -%}
      
      {%- comment -%} 2. Collection Fallback {%- endcomment -%}
      {%- elsif section.settings.collection != blank -%}
        {%- for product in collections[section.settings.collection].products limit: 12 -%}
           <div class="rishu-product-card">
               <div class="rishu-card-image-wrapper">
                 <a href="{{ product.url }}" class="rishu-card-link">
                   {{ product.featured_image | image_url: width: 600 | image_tag: class: 'rishu-card-img', loading: 'lazy' }}
                 </a>
                 
                 <div class="rishu-card-badges">
                   {%- if product.compare_at_price > product.price -%}
                     {%- assign discount = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
                     <span class="rishu-badge discount-badge">-{{ discount }}%</span>
                   {%- endif -%}
                   
                   {%- if product.tags.size > 0 -%}
                      <span class="rishu-badge tag-badge">{{ product.tags.first }}</span>
                   {%- endif -%}
                 </div>
               </div>

               <div class="rishu-card-info">
                 <h3 class="rishu-card-title"><a href="{{ product.url }}">{{ product.title | truncate: 50 }}</a></h3>
                 <div class="rishu-card-price">
                   {%- if product.compare_at_price > product.price -%}
                     <span class="price-sale">{{ product.price | money }}</span>
                     <span class="price-compare">{{ product.compare_at_price | money }}</span>
                   {%- else -%}
                     <span class="price-regular">{{ product.price | money }}</span>
                   {%- endif -%}
                 </div>
                 
                 <form method="post" action="/cart/add" class="rishu-quick-add-form">
                   <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                   <button type="submit" class="rishu-btn-add">Add to Cart</button>
                 </form>
               </div>
             </div>
        {%- endfor -%}
      
      {%- comment -%} 3. Onboarding (Empty State) {%- endcomment -%}
      {%- else -%}
        {%- for i in (1..6) -%}
          <div class="rishu-product-card">
             <div class="rishu-card-image-wrapper">
               {{ 'product-' | append: i | placeholder_svg_tag: 'rishu-placeholder-img' }}
             </div>
             <div class="rishu-card-info">
               <h3>Example Product</h3>
               <p>$19.99</p>
             </div>
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Rishu Best Seller",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Best Sellers"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Used if no individual products are added below"
    },
    {
       "type": "color",
       "id": "bg_color",
       "label": "Background Color",
       "default": "#ffffff"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Background Image"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
     {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Rishu Best Seller",
      "settings": {
        "heading": "Our Best Sellers"
      }
    }
  ]
}
{% endschema %}
