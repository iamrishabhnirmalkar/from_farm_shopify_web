{%- liquid
  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed
  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots
  assign slide_height = section.settings.slide_height
  assign bg_color = section.settings.bg_color
-%}

<div
  class="rishu-promo-slider-section rishu-promo-layout-main-half"
  style="{% if bg_color != blank %}background-color: {{ bg_color }};{% endif %}"
  data-autoplay="{{ autoplay }}"
  data-speed="{{ autoplay_speed }}"
  data-slide-height="{{ slide_height }}"
>
  <div class="rishu-promo-slider page-width">
    <div class="rishu-promo-slides">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'slide' -%}
            <div
              class="rishu-promo-slide {% if forloop.first %}active{% endif %}"
              data-slide-index="{{ forloop.index0 }}"
              {{ block.shopify_attributes }}
            >
              <div class="rishu-promo-frame">
                {%- comment -%} Main slide: full width, 2/3 height (full height of main) {%- endcomment -%}
                <div class="rishu-promo-main">
                  {%- if block.settings.main_link != blank -%}
                    <a href="{{ block.settings.main_link }}" class="rishu-promo-main-link" aria-label="{{ block.settings.main_image.alt | default: 'View' }}"></a>
                  {%- endif -%}
                  {%- if block.settings.main_image != blank -%}
                    {%- if forloop.first -%}
                      {{
                        block.settings.main_image
                        | image_url: width: 2400
                        | image_tag:
                          loading: 'eager',
                          fetchpriority: 'high',
                          class: 'rishu-promo-image',
                          sizes: '100vw',
                          widths: '375, 550, 750, 1100, 1500, 1780, 2000, 2400',
                          alt: block.settings.main_image.alt | default: 'Main promo'
                      }}
                    {%- else -%}
                      {{
                        block.settings.main_image
                        | image_url: width: 2400
                        | image_tag:
                          loading: 'lazy',
                          fetchpriority: 'low',
                          class: 'rishu-promo-image',
                          sizes: '100vw',
                          widths: '375, 550, 750, 1100, 1500, 1780, 2000, 2400',
                          alt: block.settings.main_image.alt | default: 'Main promo'
                      }}
                    {%- endif -%}
                  {%- else -%}
                    <div class="rishu-promo-placeholder">
                      {{ 'lifestyle-1' | placeholder_svg_tag: 'rishu-promo-placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </div>

                {%- comment -%} Secondary row: two slides, each half the height of main (1/3 total each) {%- endcomment -%}
                <div class="rishu-promo-secondary-row">
                  <div class="rishu-promo-secondary">
                    {%- if block.settings.secondary_link_1 != blank -%}
                      <a href="{{ block.settings.secondary_link_1 }}" class="rishu-promo-secondary-link" aria-label="{{ block.settings.secondary_image_1.alt | default: 'View' }}"></a>
                    {%- endif -%}
                    {%- if block.settings.secondary_image_1 != blank -%}
                      {{
                        block.settings.secondary_image_1
                        | image_url: width: 1200
                        | image_tag:
                          loading: 'lazy',
                          class: 'rishu-promo-image',
                          sizes: '(min-width: 750px) 50vw, 100vw',
                          widths: '375, 550, 750, 1100',
                          alt: block.settings.secondary_image_1.alt | default: 'Promo'
                      }}
                    {%- else -%}
                      <div class="rishu-promo-placeholder rishu-promo-placeholder-half"></div>
                    {%- endif -%}
                  </div>
                  <div class="rishu-promo-secondary">
                    {%- if block.settings.secondary_link_2 != blank -%}
                      <a href="{{ block.settings.secondary_link_2 }}" class="rishu-promo-secondary-link" aria-label="{{ block.settings.secondary_image_2.alt | default: 'View' }}"></a>
                    {%- endif -%}
                    {%- if block.settings.secondary_image_2 != blank -%}
                      {{
                        block.settings.secondary_image_2
                        | image_url: width: 1200
                        | image_tag:
                          loading: 'lazy',
                          class: 'rishu-promo-image',
                          sizes: '(min-width: 750px) 50vw, 100vw',
                          widths: '375, 550, 750, 1100',
                          alt: block.settings.secondary_image_2.alt | default: 'Promo'
                      }}
                    {%- else -%}
                      <div class="rishu-promo-placeholder rishu-promo-placeholder-half"></div>
                    {%- endif -%}
                  </div>
                </div>
              </div>
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>

    {%- if section.blocks.size > 1 -%}
      {%- if show_arrows -%}
        <div class="rishu-promo-arrows">
          <button type="button" class="rishu-promo-arrow rishu-promo-arrow-prev" aria-label="Previous slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button type="button" class="rishu-promo-arrow rishu-promo-arrow-next" aria-label="Next slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      {%- endif -%}

      {%- if show_dots -%}
        <div class="rishu-promo-dots">
          {%- for block in section.blocks -%}
            {%- if block.type == 'slide' -%}
              <button
                type="button"
                class="rishu-promo-dot {% if forloop.first %}active{% endif %}"
                data-slide="{{ forloop.index0 }}"
                aria-label="Go to slide {{ forloop.index }}"
              ></button>
            {%- endif -%}
          {%- endfor -%}
        </div>
      {%- endif -%}
    {%- endif -%}
  </div>
</div>

<script>
  (function() {
    function initPromoSliders() {
      document.querySelectorAll('.rishu-promo-slider-section').forEach(function(section) {
        var slider = section.querySelector('.rishu-promo-slider');
        var slides = slider ? slider.querySelectorAll('.rishu-promo-slide') : [];
        var dots = section.querySelectorAll('.rishu-promo-dot');
        var prevBtn = section.querySelector('.rishu-promo-arrow-prev');
        var nextBtn = section.querySelector('.rishu-promo-arrow-next');
        if (slides.length <= 1) return;

        var currentIndex = 0;
        var autoplay = section.dataset.autoplay === 'true';
        var speed = parseInt(section.dataset.speed, 10) * 1000 || 5000;
        var autoplayTimer = null;

        function goToSlide(index) {
          if (index === currentIndex) return;
          var prev = currentIndex;
          currentIndex = index;
          slides[prev].classList.remove('active');
          slides[currentIndex].classList.add('active');
          dots.forEach(function(dot, i) {
            dot.classList.toggle('active', i === currentIndex);
          });
          if (autoplay) {
            clearInterval(autoplayTimer);
            autoplayTimer = setInterval(next, speed);
          }
        }
        function next() {
          goToSlide((currentIndex + 1) % slides.length);
        }
        function prev() {
          goToSlide((currentIndex - 1 + slides.length) % slides.length);
        }

        prevBtn && prevBtn.addEventListener('click', prev);
        nextBtn && nextBtn.addEventListener('click', next);
        dots.forEach(function(dot, index) {
          dot.addEventListener('click', function() { goToSlide(index); });
        });

        var startX = 0;
        section.addEventListener('touchstart', function(e) { startX = e.touches[0].clientX; }, { passive: true });
        section.addEventListener('touchend', function(e) {
          var endX = e.changedTouches[0].clientX;
          if (Math.abs(startX - endX) > 50) (startX > endX) ? next() : prev();
        }, { passive: true });

        if (autoplay) {
          autoplayTimer = setInterval(next, speed);
          section.addEventListener('mouseenter', function() { clearInterval(autoplayTimer); });
          section.addEventListener('mouseleave', function() { autoplayTimer = setInterval(next, speed); });
        }
      });
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPromoSliders);
    } else {
      initPromoSliders();
    }
  })();
</script>

{% schema %}
{
  "name": "Promo / Ad Slider",
  "tag": "section",
  "class": "rishu-promo-slider-section-wrapper",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#f5f5f5"
    },
    {
      "type": "select",
      "id": "slide_height",
      "label": "Total slide height",
      "options": [
        { "value": "60vh", "label": "Small (60vh)" },
        { "value": "70vh", "label": "Medium (70vh)" },
        { "value": "80vh", "label": "Large (80vh)" },
        { "value": "90vh", "label": "Extra large (90vh)" }
      ],
      "default": "80vh",
      "info": "Main slide is 2/3 of this; the two below are 1/3 each (half the main height)."
    },
    {
      "type": "header",
      "content": "Slider"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Change slides every",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show dots",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide (main + 2 secondary)",
      "settings": [
        {
          "type": "header",
          "content": "Main slide (full height)"
        },
        {
          "type": "image_picker",
          "id": "main_image",
          "label": "Main image",
          "info": "Hero banner â€“ full width, 2/3 of slide height."
        },
        {
          "type": "url",
          "id": "main_link",
          "label": "Main link"
        },
        {
          "type": "header",
          "content": "Secondary slide 1 (half height)"
        },
        {
          "type": "image_picker",
          "id": "secondary_image_1",
          "label": "Secondary image 1"
        },
        {
          "type": "url",
          "id": "secondary_link_1",
          "label": "Secondary link 1"
        },
        {
          "type": "header",
          "content": "Secondary slide 2 (half height)"
        },
        {
          "type": "image_picker",
          "id": "secondary_image_2",
          "label": "Secondary image 2"
        },
        {
          "type": "url",
          "id": "secondary_link_2",
          "label": "Secondary link 2"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Promo / Ad Slider",
      "blocks": [
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}
