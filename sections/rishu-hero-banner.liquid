{{ 'rish-custom.css' | asset_url | stylesheet_tag }}

<div 
  class="rishu-hero-banner"
  data-autoplay="{{ section.settings.autoplay }}"
  data-speed="{{ section.settings.autoplay_speed }}"
  data-animation="{{ section.settings.animation_type }}"
  style="--rishu-hero-desktop-height: {{ section.settings.desktop_height }}; {% if section.settings.bg_color != blank %}background-color: {{ section.settings.bg_color }};{% endif %}"
>
  <div class="rishu-hero-slider">
    <div class="rishu-hero-slides">
      {%- for block in section.blocks -%}
        <div 
          class="rishu-hero-slide {% if forloop.first %}active{% endif %}"
          data-slide-index="{{ forloop.index0 }}"
          {{ block.shopify_attributes }}
        >
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="rishu-hero-slide-link" aria-label="{{ block.settings.image.alt | default: 'Slide link' }}"></a>
          {%- endif -%}
          
          {%- comment -%} Desktop Image {%- endcomment -%}
          {%- if block.settings.image != blank -%}
            <picture class="rishu-hero-picture">
              {%- if block.settings.mobile_image != blank -%}
                {%- comment -%} Mobile-specific image if provided {%- endcomment -%}
                <source
                  media="(max-width: 749px)"
                  srcset="
                    {{ block.settings.mobile_image | image_url: width: 600 }} 600w,
                    {{ block.settings.mobile_image | image_url: width: 800 }} 800w,
                    {{ block.settings.mobile_image | image_url: width: 1200 }} 1200w
                  "
                  sizes="100vw"
                >
              {%- endif -%}
              
              {%- comment -%} Desktop image (or fallback for mobile if no mobile image) {%- endcomment -%}
              {{
                block.settings.image
                | image_url: width: 3840
                | image_tag:
                  loading: 'lazy',
                  width: block.settings.image.width,
                  height: block.settings.image.height,
                  alt: block.settings.image.alt | default: block.settings.alt_text,
                  class: 'rishu-hero-image',
                  sizes: '100vw',
                  widths: '375, 750, 1100, 1500, 1780, 2000, 3000, 3840'
              }}
            </picture>
          {%- else -%}
            {%- comment -%} Placeholder if no image {%- endcomment -%}
            {{ 'hero-apparel-1' | placeholder_svg_tag: 'rishu-hero-image rishu-hero-placeholder' }}
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>

    {%- if section.blocks.size > 1 -%}
      {%- comment -%} Navigation Arrows {%- endcomment -%}
      {%- if section.settings.show_arrows -%}
        <div class="rishu-hero-arrows">
          <button 
            type="button" 
            class="rishu-hero-arrow rishu-hero-arrow-prev" 
            aria-label="Previous slide"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button 
            type="button" 
            class="rishu-hero-arrow rishu-hero-arrow-next" 
            aria-label="Next slide"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      {%- endif -%}

      {%- comment -%} Pagination Dots {%- endcomment -%}
      {%- if section.settings.show_dots -%}
        <div class="rishu-hero-dots">
          {%- for block in section.blocks -%}
            <button 
              type="button"
              class="rishu-hero-dot {% if forloop.first %}active{% endif %}"
              data-slide="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}"
            ></button>
          {%- endfor -%}
        </div>
      {%- endif -%}
    {%- endif -%}
  </div>
</div>

<script>
  class RishuHeroSlider {
    constructor(container) {
      this.container = container;
      this.slides = container.querySelectorAll('.rishu-hero-slide');
      this.dots = container.querySelectorAll('.rishu-hero-dot');
      this.prevBtn = container.querySelector('.rishu-hero-arrow-prev');
      this.nextBtn = container.querySelector('.rishu-hero-arrow-next');
      this.currentIndex = 0;
      this.autoplay = container.dataset.autoplay === 'true';
      this.speed = parseInt(container.dataset.speed) * 1000 || 5000;
      this.animation = container.dataset.animation || 'fade';
      this.autoplayTimer = null;

      this.init();
    }

    init() {
      if (this.slides.length <= 1) return;

      // Event listeners
      this.prevBtn?.addEventListener('click', () => this.prev());
      this.nextBtn?.addEventListener('click', () => this.next());
      
      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });

      // Touch/swipe support
      this.addSwipeSupport();

      // Start autoplay
      if (this.autoplay) {
        this.startAutoplay();
        
        // Pause on hover
        this.container.addEventListener('mouseenter', () => this.stopAutoplay());
        this.container.addEventListener('mouseleave', () => this.startAutoplay());
      }
    }

    goToSlide(index) {
      if (index === this.currentIndex) return;

      const prevIndex = this.currentIndex;
      this.currentIndex = index;

      // Update slides
      this.slides[prevIndex].classList.remove('active');
      this.slides[this.currentIndex].classList.add('active');

      // Update dots
      this.dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === this.currentIndex);
      });

      // Reset autoplay timer
      if (this.autoplay) {
        this.stopAutoplay();
        this.startAutoplay();
      }
    }

    next() {
      const nextIndex = (this.currentIndex + 1) % this.slides.length;
      this.goToSlide(nextIndex);
    }

    prev() {
      const prevIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;
      this.goToSlide(prevIndex);
    }

    startAutoplay() {
      this.autoplayTimer = setInterval(() => this.next(), this.speed);
    }

    stopAutoplay() {
      if (this.autoplayTimer) {
        clearInterval(this.autoplayTimer);
        this.autoplayTimer = null;
      }
    }

    addSwipeSupport() {
      let startX = 0;
      let endX = 0;

      this.container.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
      }, { passive: true });

      this.container.addEventListener('touchend', (e) => {
        endX = e.changedTouches[0].clientX;
        const diff = startX - endX;

        if (Math.abs(diff) > 50) {
          if (diff > 0) {
            this.next();
          } else {
            this.prev();
          }
        }
      }, { passive: true });
    }
  }

  // Initialize all hero sliders
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.rishu-hero-banner').forEach(slider => {
      new RishuHeroSlider(slider);
    });
  });
</script>

{% schema %}
{
  "name": "Rishu Hero Banner",
  "tag": "section",
  "class": "rishu-hero-section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "desktop_height",
      "label": "Desktop Height",
      "options": [
        {
          "value": "auto",
          "label": "Auto (Full Image)"
        },
        {
          "value": "60vh",
          "label": "Small (60vh)"
        },
        {
          "value": "70vh",
          "label": "Medium (70vh)"
        },
        {
          "value": "80vh",
          "label": "Large (80vh)"
        },
        {
          "value": "90vh",
          "label": "Extra Large (90vh)"
        },
        {
          "value": "100vh",
          "label": "Full Screen (100vh)"
        }
      ],
      "default": "auto",
      "info": "Auto shows the complete image without cropping"
    },
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "select",
      "id": "animation_type",
      "label": "Animation Type",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        },
        {
          "value": "zoom",
          "label": "Zoom"
        }
      ],
      "default": "fade",
      "info": "Choose the transition animation between slides"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-play slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Auto-play speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5,
      "info": "Time each slide is displayed"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show pagination dots",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Recommended: 1920x1080px or larger"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image (Optional)",
          "info": "Use a different image for mobile devices. If not set, the main image will be used."
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Image Alt Text",
          "info": "Describe the image for accessibility"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Slide Link",
          "info": "Make the entire slide clickable"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Rishu Hero Banner",
      "category": "Rishu",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
